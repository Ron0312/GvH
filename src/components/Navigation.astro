---
import { Icon } from 'lucide-react';

const links = [
    { href: '/', label: 'Ouvertüre' },
    { href: '/philosophie', label: 'Der Komponist' },
    { href: '/werkschau', label: 'Werkschau' },
    { href: '/expertise', label: 'Disziplinen' },
    { href: '/standorte', label: 'Präsenz' },
    { href: '/journal', label: 'Resonanzraum' },
    { href: '/kontakt', label: 'Concierge' }
];

const { currentPath } = Astro.props;
const isHome = currentPath === '/' || currentPath === '';

// Initial State Classes
const headerBgClass = isHome ? 'bg-transparent py-4 md:py-6' : 'bg-white/95 backdrop-blur-md shadow-sm py-2 md:py-3';
const textMainClass = isHome ? 'text-white' : 'text-[#1A1A1A]';
const textSubClass = isHome ? 'text-white/60' : 'text-[#1A1A1A] opacity-40';
const toggleClass = isHome ? 'text-white' : 'text-black';

const getLinkClass = (href) => {
    if (currentPath === href) return "text-[#A0522D] font-black";
    return isHome ? "text-white/60 hover:text-white" : "text-[#1A1A1A]/50 hover:text-[#1A1A1A]";
};
---

<header id="main-header" data-is-home={isHome ? "true" : "false"} class={`fixed top-0 w-full z-[1000] transition-all duration-500 ${headerBgClass}`}>
    <nav class="max-w-[1600px] mx-auto px-6 md:px-12 flex justify-between items-center relative z-[1001]">
        <div class="magnetic-wrap">
            <a href="/" class="flex flex-col cursor-pointer relative group" onmouseenter="window.setCursorMode(true, 'Start')" onmouseleave="window.setCursorMode(false)">
                <span class={`header-text font-serif italic text-xl md:text-2xl lg:text-3xl tracking-tighter transition-colors duration-500 ${textMainClass}`}>Gaerten von Hoerschelmann</span>
                <span class={`header-sub text-[6px] md:text-[8px] uppercase tracking-[0.5em] -mt-1 font-bold transition-colors duration-500 ${textSubClass}`}>Landschaftskomposition</span>
            </a>
        </div>

        <div class="hidden lg:flex gap-8">
            {links.map(link => (
                <a href={link.href}
                   onmouseenter="window.setCursorMode(true)"
                   onmouseleave="window.setCursorMode(false)"
                   class:list={[
                       "header-link text-[9px] uppercase tracking-[0.4em] relative py-1 transition-all",
                       getLinkClass(link.href)
                   ]}>
                    {link.label}
                    {currentPath === link.href && <span class="absolute bottom-0 left-0 w-full h-[1px] bg-[#A0522D]"></span>}
                </a>
            ))}
        </div>

        <button id="mobile-menu-toggle" class={`lg:hidden relative p-2 transition-colors duration-500 ${toggleClass}`} aria-label="Hauptmenü">
             <i data-lucide="menu" width="26" height="26"></i>
        </button>
    </nav>

    <div id="mobile-menu" class="fixed inset-0 bg-[#FDFCFB] z-[1000] flex flex-col items-center justify-center transition-all duration-700 -translate-y-full opacity-0 invisible pointer-events-none">
        <button id="mobile-menu-close" class="absolute top-6 right-6 p-2 text-black">
            <i data-lucide="x" width="26" height="26"></i>
        </button>
        <div class="flex flex-col gap-6 text-center px-6 pt-10">
            {links.map(link => (
                <a href={link.href} class="text-2xl uppercase tracking-[0.12em] font-serif italic transition-all duration-300 text-black opacity-40 hover:text-[#A0522D]">
                    {link.label}
                </a>
            ))}
        </div>
    </div>
</header>

<script>
    import { createIcons, Menu, X } from 'lucide';

    createIcons({
        icons: {
            Menu,
            X
        }
    });

    const header = document.getElementById('main-header');
    const headerText = document.querySelector('.header-text');
    const headerSub = document.querySelector('.header-sub');
    const headerLinks = document.querySelectorAll('.header-link');
    const toggle = document.getElementById('mobile-menu-toggle');
    const close = document.getElementById('mobile-menu-close');
    const menu = document.getElementById('mobile-menu');

    // Light header logic based on scroll or page
    const updateHeader = () => {
        const scrolled = window.scrollY > 40;
        const isHome = header?.dataset.isHome === 'true';
        const isLight = scrolled || !isHome;

        if (isLight) {
            header?.classList.add('bg-white/95', 'backdrop-blur-md', 'shadow-sm', 'py-2', 'md:py-3');
            header?.classList.remove('bg-transparent', 'py-4', 'md:py-6');

            headerText?.classList.remove('text-white');
            headerText?.classList.add('text-[#1A1A1A]');

            headerSub?.classList.remove('text-white/60');
            headerSub?.classList.add('text-[#1A1A1A]', 'opacity-40');

            toggle?.classList.remove('text-white');
            toggle?.classList.add('text-black');

            headerLinks.forEach(l => {
                if (!l.classList.contains('text-[#A0522D]')) {
                    l.classList.remove('text-white/60', 'hover:text-white');
                    l.classList.add('text-[#1A1A1A]/50', 'hover:text-[#1A1A1A]');
                }
            });
        } else {
            header?.classList.remove('bg-white/95', 'backdrop-blur-md', 'shadow-sm', 'py-2', 'md:py-3');
            header?.classList.add('bg-transparent', 'py-4', 'md:py-6');

            headerText?.classList.remove('text-[#1A1A1A]');
            headerText?.classList.add('text-white');

            headerSub?.classList.remove('text-[#1A1A1A]', 'opacity-40');
            headerSub?.classList.add('text-white/60');

            toggle?.classList.remove('text-black');
            toggle?.classList.add('text-white');

             headerLinks.forEach(l => {
                if (!l.classList.contains('text-[#A0522D]')) {
                    l.classList.remove('text-[#1A1A1A]/50', 'hover:text-[#1A1A1A]');
                    l.classList.add('text-white/60', 'hover:text-white');
                }
            });
        }
    };

    window.addEventListener('scroll', updateHeader);
    // Initial check
    updateHeader();

    // Mobile Menu
    toggle?.addEventListener('click', () => {
        menu?.classList.remove('-translate-y-full', 'opacity-0', 'invisible', 'pointer-events-none');
        menu?.classList.add('translate-y-0', 'opacity-100', 'visible');
    });

    close?.addEventListener('click', () => {
        menu?.classList.add('-translate-y-full', 'opacity-0', 'invisible', 'pointer-events-none');
        menu?.classList.remove('translate-y-0', 'opacity-100', 'visible');
    });
</script>
