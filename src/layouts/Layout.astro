---
import '../styles/global.css';
import Soundscape from '../components/Soundscape';

interface Props {
	title: string;
    description?: string;
    schema?: string; // Optional custom schema prop
}

const { title, description = "Meisterhafte Gartenarchitektur und Speziallösungen für komplexe Hanglagen und exklusive Refugien.", schema } = Astro.props;

// Global Schema (LocalBusiness)
const globalSchema = JSON.stringify({
  "@context": "https://schema.org",
  "@type": "LandscapeArchitect",
  "name": "Gaerten von Hoerschelmann",
  "description": description,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Lademannbogen 41",
    "addressLocality": "Hamburg",
    "postalCode": "22339",
    "addressCountry": "DE"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": "53.6471",
    "longitude": "10.0573"
  },
  "url": "https://gaertenvonhoerschelmann.de",
  "telephone": "+49 40 123456789",
  "founder": {
    "@type": "Person",
    "name": "Sören von Hoerschelmann"
  },
  "image": "https://gaertenvonhoerschelmann.de/img/Wohnen-Garten-Blick-aus-der-Terrassentuer-Rahmen-Parrotie-Eisenholz-Gaerten-des-Jahres-scaled.jpg",
  "priceRange": "$$$",
  "areaServed": ["Hamburg", "Lauenburg", "Sylt", "Kitzbühel"],
  "openingHours": "Mo-Fr 08:00-18:00"
});
---

<!doctype html>
<html lang="de" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />

        <!-- Security Headers (Simulation for meta) -->
        <meta http-equiv="X-XSS-Protection" content="1; mode=block">
        <meta http-equiv="X-Content-Type-Options" content="nosniff">
        <meta name="referrer" content="strict-origin-when-cross-origin">

        <link rel="preconnect" href="https://fonts.bunny.net">
        <link href="https://fonts.bunny.net/css?family=playfair-display:400,400i,700|inter:200,300,400,600,700" rel="stylesheet" />

        <!-- Open Graph Tags -->
        <meta property="og:title" content={title}>
        <meta property="og:description" content={description}>
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="Gaerten von Hoerschelmann">
        <meta name="twitter:card" content="summary_large_image">

        <!-- Structured Data -->
        <script type="application/ld+json" set:html={globalSchema}></script>
        {schema && <script type="application/ld+json" set:html={schema}></script>}

		<title>{title}</title>

        <script>
             // Lenis
            import Lenis from '@studio-freight/lenis'

            const lenis = new Lenis({
                duration: 1.4,
                easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t))
            })

            function raf(time) {
                lenis.raf(time)
                requestAnimationFrame(raf)
            }

            requestAnimationFrame(raf)

            // Custom Cursor with advanced mode
            if (window.matchMedia("(min-width: 1024px)").matches) {
                const cursorDot = document.createElement('div');
                cursorDot.classList.add('custom-cursor');
                cursorDot.id = 'cursor-dot';

                const cursorOutline = document.createElement('div');
                cursorOutline.classList.add('custom-cursor-outline');
                cursorOutline.id = 'cursor-outline';

                const cursorText = document.createElement('div');
                cursorText.classList.add('cursor-text');
                cursorText.id = 'cursor-text';
                cursorOutline.appendChild(cursorText);

                document.body.appendChild(cursorDot);
                document.body.appendChild(cursorOutline);

                let mouseX = 0, mouseY = 0, dotX = 0, dotY = 0, outX = 0, outY = 0;

                window.addEventListener('mousemove', (e) => {
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                });

                const animateCursor = () => {
                    dotX += (mouseX - dotX) * 0.2;
                    dotY += (mouseY - dotY) * 0.2;
                    outX += (mouseX - outX) * 0.1;
                    outY += (mouseY - outY) * 0.1;

                    cursorDot.style.transform = `translate3d(${dotX}px, ${dotY}px, 0) translate(-50%, -50%)`;
                    cursorOutline.style.transform = `translate3d(${outX}px, ${outY}px, 0) translate(-50%, -50%)`;

                    requestAnimationFrame(animateCursor);
                };
                requestAnimationFrame(animateCursor);
            }

            // Global helpers for cursor interaction
            window.setCursorMode = (active, text = "Details") => {
                if(window.innerWidth < 1024) return;
                const out = document.getElementById('cursor-outline');
                const txt = document.getElementById('cursor-text');
                if(out && txt) {
                    if(active) {
                        out.classList.add('hover-active');
                        if(text) txt.innerText = text;
                    } else {
                        out.classList.remove('hover-active');
                    }
                }
            };

            // Season Switch Logic
            const month = new Date().getMonth(); // 0-11
            const body = document.body;
            // Simple class application for potential CSS hooks
            if (month >= 2 && month <= 4) body.classList.add('season-spring');
            else if (month >= 5 && month <= 7) body.classList.add('season-summer');
            else if (month >= 8 && month <= 10) body.classList.add('season-autumn');
            else body.classList.add('season-winter');

            // Scroll Progress
            const progressBar = document.createElement('div');
            progressBar.classList.add('scroll-progress');
            document.body.appendChild(progressBar);

            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                progressBar.style.width = scrolled + "%";
            });

        </script>
	</head>
	<body class="season-default">
        <!-- Loader: Dirigentenstock -->
        <div id="preloader" class="preloader">
            <div class="baton-container">
                <div class="baton-fill"></div>
            </div>
            <div class="loader-logo">Gaerten von Hoerschelmann</div>
        </div>

        <Soundscape client:idle />

		<slot />

        <script>
            // Preloader logic
            window.addEventListener('load', () => {
                const loader = document.getElementById('preloader');
                // Ensure animation has time to be seen
                setTimeout(() => {
                    if(loader) loader.classList.add('fade-out');
                }, 1500);
            });

            // Intersection Observer for reveals
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('active');
                });
            }, { threshold: 0.1 });

            setTimeout(() => {
                document.querySelectorAll('.reveal-obs').forEach(el => observer.observe(el));
            }, 100);
        </script>
	</body>
</html>
